# llm-benchmark

GPU ì„œë²„ í™˜ê²½ì—ì„œ LLM ì„±ëŠ¥ì„ ìë™ ì¸¡ì •í•˜ê¸° ìœ„í•œ ë‚´ë¶€ìš© ë²¤ì¹˜ë§ˆí¬ ë„êµ¬ì…ë‹ˆë‹¤.

## ê°œìš”

`llm-benchmark`ëŠ” S-COREì˜ LLM Run Package êµ¬ì„± ìš”ì†Œ(vLLM, LiteLLM ë“±)ë¥¼ ëŒ€ìƒìœ¼ë¡œ  
**ì§€ì—°ì‹œê°„, ì²˜ë¦¬ëŸ‰, ì•ˆì •ì„±, íš¨ìœ¨ì„±**ì„ ìë™ ì¸¡ì •í•˜ê³  ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

- âœ… OpenAI í˜¸í™˜ API ëŒ€ìƒ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (`/v1/chat/completions`)
- âœ… TTFT (Time To First Token), ì‘ë‹µì‹œê°„, í† í° ì²˜ë¦¬ëŸ‰ ì¸¡ì •
- âœ… ì›Œí¬ë¡œë“œë³„/ëª¨ë¸ë³„ ì„±ëŠ¥ ë¹„êµ ë¦¬í¬íŠ¸ ìë™ ìƒì„±
- âœ… ë¹„ë™ê¸° ìš”ì²­ ì²˜ë¦¬ë¡œ ëŒ€ê·œëª¨ ë¶€í•˜ ì‹œë®¬ë ˆì´ì…˜
- ğŸ”„ GPU ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ ë¶„ì„ (í™•ì¥ ì˜ˆì •)

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
llm-benchmark/
â”œâ”€â”€ scripts/              # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ run_bench.py      # ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰
â”‚   â”œâ”€â”€ parse_metrics.py  # ê²°ê³¼ íŒŒì‹± ë° í†µê³„ ê³„ì‚°
â”‚   â”œâ”€â”€ gen_report.py     # ë¦¬í¬íŠ¸ ìƒì„±
â”‚   â””â”€â”€ run_bench.sh      # ì „ì²´ íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ configs/              # ì„¤ì • íŒŒì¼
â”‚   â”œâ”€â”€ targets.yaml      # ë²¤ì¹˜ë§ˆí¬ ëŒ€ìƒ ì—”ë“œí¬ì¸íŠ¸
â”‚   â”œâ”€â”€ models.yaml       # í…ŒìŠ¤íŠ¸ ëª¨ë¸ ëª©ë¡
â”‚   â””â”€â”€ workloads.yaml    # ì›Œí¬ë¡œë“œ íŒ¨í„´ ì •ì˜
â”œâ”€â”€ results/              # ê²°ê³¼ ì €ì¥
â”‚   â”œâ”€â”€ raw/              # ì›ì‹œ ì¸¡ì • ë¡œê·¸ (JSONL)
â”‚   â”œâ”€â”€ summary/          # í†µê³„ ìš”ì•½ (CSV)
â”‚   â””â”€â”€ reports/          # ìµœì¢… ë¦¬í¬íŠ¸ (Markdown)
â””â”€â”€ .github/              # í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

## ì„¤ì¹˜

### ìš”êµ¬ì‚¬í•­

- Python 3.11+
- pip

### ì˜ì¡´ì„± ì„¤ì¹˜

```bash
pip install -r requirements.txt
```

## ì‚¬ìš©ë²•

### ì¸¡ì • ë°©ì‹

`llm-benchmark`ëŠ” ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ëŠ” **ë¶€í•˜ ìƒì„± ê¸°ë°˜ ì„±ëŠ¥ ì¸¡ì •** ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

1. **ë¹„ë™ê¸° ìš”ì²­ ìƒì„±**: ì„¤ì •ëœ RPS(ì´ˆë‹¹ ìš”ì²­ ìˆ˜)ì— ë§ì¶° ì¼ì •í•œ ê°„ê²©ìœ¼ë¡œ ìš”ì²­ì„ ìƒì„±
2. **ë™ì‹œì„± ì œì–´**: ì—¬ëŸ¬ ìš”ì²­ì´ ë™ì‹œì— ì²˜ë¦¬ë˜ë„ë¡ ë¹„ë™ê¸° íƒœìŠ¤í¬ë¡œ ë³‘ë ¬ ì‹¤í–‰
3. **ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì¸¡ì •**: 
   - TTFT (Time To First Token): ì²« í† í° ìˆ˜ì‹ ê¹Œì§€ì˜ ì‹œê°„
   - ì „ì²´ ì‘ë‹µ ì‹œê°„: ìš”ì²­ë¶€í„° ì™„ë£Œê¹Œì§€ì˜ ì´ ì‹œê°„
   - í† í° ì²˜ë¦¬ëŸ‰: ìƒì„±ëœ í† í° ìˆ˜ / ìƒì„± ì‹œê°„
4. **í†µê³„ ë¶„ì„**: Mean, Median, P95, P99 ë“±ì˜ ë°±ë¶„ìœ„ìˆ˜ ê³„ì‚°

### ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤ ì˜ˆì‹œ

```bash
$ python3 scripts/run_bench_interactive.py

============================================================
ğŸš€ LLM ë²¤ì¹˜ë§ˆí¬ ëŒ€í™”í˜• ì‹¤í–‰
============================================================

ğŸ’¡ íŒ: ì—”í„°ë§Œ ì¹˜ë©´ ê¸°ë³¸ê°’ ì‚¬ìš© (5ë¶„ ê³ ë¶€í•˜ í…ŒìŠ¤íŠ¸)


ğŸ“¡ ë²¤ì¹˜ë§ˆí¬ ëŒ€ìƒ ì„œë²„ ì„ íƒ:
  â†’ 1. spark-test: Spark GPU ì„œë²„ (DGX í…ŒìŠ¤íŠ¸ìš©)
    2. titan-test: Titan GPU ì„œë²„ (A100x8)
    3. score-main: S-Core ë©”ì¸ ì„œë²„ (H200x8)

ì„ íƒ (1-3) [ê¸°ë³¸ê°’: 1]: â†µ

ğŸ¤– í…ŒìŠ¤íŠ¸ ëª¨ë¸ ì„ íƒ:
  â†’ 1. qwen3-coder-30b: Qwen3 Coder 30B (ì½”ë“œ ìƒì„± íŠ¹í™”)
    2. qwen3-4b: Qwen3 4B (ê²½ëŸ‰ ëª¨ë¸)
    3. llama-3.1-70b-fp8: Llama 3.1 70B FP8 (ëŒ€ìš©ëŸ‰)

ì„ íƒ (1-3) [ê¸°ë³¸ê°’: 1]: â†µ

âš™ï¸  ì›Œí¬ë¡œë“œ ì„¤ì •:
  â†’ 1. ê¸°ë³¸ ì„¤ì • ì‚¬ìš© (5ë¶„ ê³ ë¶€í•˜ í…ŒìŠ¤íŠ¸)
    2. ì‚¬ì „ ì •ì˜ëœ ì›Œí¬ë¡œë“œ ì„ íƒ
    3. ì»¤ìŠ¤í…€ ì„¤ì •

ì„ íƒ (1-3) [ê¸°ë³¸ê°’: 1]: â†µ

============================================================
ğŸ“‹ ë²¤ì¹˜ë§ˆí¬ ì„¤ì • í™•ì¸
============================================================
  ì„œë²„: spark-test - Spark GPU ì„œë²„
  ëª¨ë¸: Qwen/Qwen3-Coder-30B-A3B-Instruct
  ì›Œí¬ë¡œë“œ: 5ë¶„ ê³ ë¶€í•˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    - ì‹œê°„: 300ì´ˆ (5ë¶„)
    - RPS: 20 (ì´ˆë‹¹ ìš”ì²­ ìˆ˜)
    - ë™ì‹œì„±: 50
    - ì˜ˆìƒ ì´ ìš”ì²­: 6,000ê°œ
    - ìµœëŒ€ í† í°: 1024
    - Temperature: 0.7
    - í”„ë¡¬í”„íŠ¸ íƒ€ì…: medium
============================================================

ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (Y/n) [ê¸°ë³¸ê°’: Y]: â†µ

ğŸš€ ë²¤ì¹˜ë§ˆí¬ ì‹œì‘!

=== Starting workload: high-load-5min ===
Target: spark-test, Model: Qwen/Qwen3-Coder-30B-A3B-Instruct
Duration: 300s, RPS: 20, Concurrency: 50
Expected total requests: 6000

======================================================================
â±ï¸  ì§„í–‰: 120s / 300s (40.0%) | ìš”ì²­: 2,400 / 6,000 | ë‚¨ì€ ì‹œê°„: 180s (3ë¶„ 0ì´ˆ)
```

### CLI ëª¨ë“œ ì˜ˆì‹œ

```bash
# 10ë¶„ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
$ python3 scripts/run_bench_interactive.py \
    --target spark-test \
    --model qwen3-coder-30b \
    --workload stress-test

============================================================
ğŸš€ CLI ëª¨ë“œë¡œ ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰
============================================================
  ì„œë²„: spark-test - Spark GPU ì„œë²„
  ëª¨ë¸: Qwen/Qwen3-Coder-30B-A3B-Instruct
  ì›Œí¬ë¡œë“œ: ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ (10ë¶„)
    - ì‹œê°„: 600ì´ˆ (10ë¶„)
    - RPS: 50 (ì´ˆë‹¹ ìš”ì²­ ìˆ˜)
    - ë™ì‹œì„±: 100
    - ì˜ˆìƒ ì´ ìš”ì²­: 30,000ê°œ

â±ï¸  ì§„í–‰: 480s / 600s (80.0%) | ìš”ì²­: 24,000 / 30,000 | ë‚¨ì€ ì‹œê°„: 120s (2ë¶„ 0ì´ˆ)

âœ… ì™„ë£Œ: 29,543ê°œ, ì„±ê³µ: 29,234ê°œ (98.9%)

ğŸ“Š ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì„¸ìš”:
  python3 scripts/parse_metrics.py results/raw/bench_spark-test_qwen3-coder-30b_stress-test_20251107_143022.jsonl
```

### 1. ì„¤ì • íŒŒì¼ í¸ì§‘

**ëŒ€ìƒ ì„œë²„ ì„¤ì •** (`configs/targets.yaml`):
```yaml
targets:
  - name: vllm-local
    base_url: http://localhost:8000/v1
    api_key: "EMPTY"
```

**í…ŒìŠ¤íŠ¸ ëª¨ë¸ ì„¤ì •** (`configs/models.yaml`):
```yaml
models:
  - name: llama-3.1-8b-instruct
    full_name: meta-llama/Meta-Llama-3.1-8B-Instruct
```

**ì›Œí¬ë¡œë“œ ì„¤ì •** (`configs/workloads.yaml`):
```yaml
workloads:
  - name: medium-load
    duration: 300  # ì´ˆ
    rps: 5         # Requests Per Second
    concurrency: 10
```

### 2. ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰

#### ğŸš€ ëŒ€í™”í˜• ì‹¤í–‰ (ì¶”ì²œ!)

```bash
# ê°€ìƒí™˜ê²½ í™œì„±í™”
source venv/bin/activate

# ëŒ€í™”í˜• ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰
python3 scripts/run_bench_interactive.py
```

**íŠ¹ì§•:**
- ğŸ’¡ ì—”í„°ë§Œ ì¹˜ë©´ ê¸°ë³¸ê°’ ì‚¬ìš© (5ë¶„ ê³ ë¶€í•˜ í…ŒìŠ¤íŠ¸)
- ì„œë²„, ëª¨ë¸, ì›Œí¬ë¡œë“œ ì„ íƒ ê°€ëŠ¥
- ì»¤ìŠ¤í…€ ì„¤ì • ì§€ì› (ì‹œê°„, RPS, í† í° ìˆ˜ ë“±)

#### ğŸ–¥ï¸ CLI ëª¨ë“œ ì‹¤í–‰ (ìë™í™”/ìŠ¤í¬ë¦½íŠ¸ìš©)

```bash
# ê°€ìƒí™˜ê²½ í™œì„±í™”
source venv/bin/activate

# ì‚¬ì „ ì •ì˜ëœ ì›Œí¬ë¡œë“œ ì‚¬ìš©
python3 scripts/run_bench_interactive.py --target spark-test --model qwen3-coder-30b --workload high-load

# ì»¤ìŠ¤í…€ ì„¤ì •ìœ¼ë¡œ ì‹¤í–‰
python3 scripts/run_bench_interactive.py --target spark-test --model qwen3-coder-30b --duration 600 --rps 50 --concurrency 100

# ë„ì›€ë§ ë³´ê¸°
python3 scripts/run_bench_interactive.py --help
```

**íŒŒë¼ë¯¸í„°:**
- `--target`: ëŒ€ìƒ ì„œë²„ ì´ë¦„ (spark-test, titan-test, score-main ë“±)
- `--model`: ëª¨ë¸ ì´ë¦„ (qwen3-coder-30b, llama-3.1-70b-fp8 ë“±)
- `--workload`: ì›Œí¬ë¡œë“œ ì´ë¦„ (low-load, medium-load, high-load, stress-test)
- `--duration`: í…ŒìŠ¤íŠ¸ ì‹œê°„ (ì´ˆ)
- `--rps`: ì´ˆë‹¹ ìš”ì²­ ìˆ˜
- `--concurrency`: ë™ì‹œ ìš”ì²­ ìˆ˜
- `--max-tokens`, `--temperature`, `--prompt-type`: ì¶”ê°€ ì˜µì…˜

#### ê°œë³„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ì €ìˆ˜ì¤€ ì œì–´)

```bash
# ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰
python3 scripts/run_bench.py --target vllm-local --model llama-3.1-8b-instruct --workload medium-load

# ê²°ê³¼ íŒŒì‹±
python3 scripts/parse_metrics.py results/raw/bench_*.jsonl

# ë¦¬í¬íŠ¸ ìƒì„±
python3 scripts/gen_report.py
```

#### ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰

```bash
# ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì‹¤í–‰
./scripts/run_bench.sh

# íŒŒë¼ë¯¸í„° ì§€ì •
./scripts/run_bench.sh vllm-local llama-3.1-8b-instruct high-load
```

### 3. ê²°ê³¼ í™•ì¸

- **ì›ì‹œ ë°ì´í„°**: `results/raw/*.jsonl`
- **í†µê³„ ìš”ì•½**: `results/summary/*.csv`
- **ë¦¬í¬íŠ¸**: `results/reports/benchmark_report.md`

## ì¸¡ì • ì§€í‘œ

### 1. TTFT (Time To First Token)
ì²« ë²ˆì§¸ í† í°ì´ ìƒì„±ë  ë•Œê¹Œì§€ì˜ ì§€ì—°ì‹œê°„

- Mean, Median, P95, P99

### 2. ì´ ì‘ë‹µ ì‹œê°„
ìš”ì²­ë¶€í„° ì‘ë‹µ ì™„ë£Œê¹Œì§€ì˜ ì´ ì‹œê°„

- Mean, Median, P95, P99

### 3. í† í° ì²˜ë¦¬ëŸ‰
ì´ˆë‹¹ ìƒì„±ë˜ëŠ” í† í° ìˆ˜ (tokens/sec)

- Mean, Median, P95

### 4. ì„±ê³µë¥ 
ì „ì²´ ìš”ì²­ ì¤‘ ì„±ê³µí•œ ìš”ì²­ì˜ ë¹„ìœ¨ (%)

## ì›Œí¬ë¡œë“œ ì‹œë‚˜ë¦¬ì˜¤

| ì‹œë‚˜ë¦¬ì˜¤ | RPS | ë™ì‹œì„± | ì„¤ëª… |
|---------|-----|--------|------|
| `low-load` | 1 | 1 | ê°œë³„ ì‚¬ìš©ì íƒìƒ‰ |
| `medium-load` | 5 | 10 | ì¼ë°˜ì ì¸ í”„ë¡œë•ì…˜ |
| `high-load` | 20 | 50 | í”¼í¬ íƒ€ì„ íŠ¸ë˜í”½ |
| `stress-test` | 50 | 100 | ì‹œìŠ¤í…œ í•œê³„ ì¸¡ì • |

## í™•ì¥ ê³„íš

- [ ] Prometheus/Grafana ì—°ë™ìœ¼ë¡œ GPU ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- [ ] í† í°ë‹¹ ì „ë ¥ íš¨ìœ¨(Tokens/W) ê³„ì‚°
- [ ] ì—¬ëŸ¬ ëª¨ë¸ ê°„ ë¹„êµ ì‹œê°í™”
- [ ] CI íŒŒì´í”„ë¼ì¸ ìë™í™” (GitHub Actions)
- [ ] HTML/PDF ë¦¬í¬íŠ¸ ìƒì„±

## ê°œë°œì ì •ë³´

**ì‘ì„±ì:** ì´ì°½ì—° (AIì‚¬ì—…ê·¸ë£¹)  
**ì‘ì„±ì¼:** 2025-11-07  
**ë¼ì´ì„ ìŠ¤:** MIT

## ê¸°ì—¬

ì´ìŠˆ ë° í’€ ë¦¬í€˜ìŠ¤íŠ¸ í™˜ì˜í•©ë‹ˆë‹¤!

---

**Note:** ì´ ë„êµ¬ëŠ” S-CORE ë‚´ë¶€ ì‚¬ìš©ì„ ìœ„í•´ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.
